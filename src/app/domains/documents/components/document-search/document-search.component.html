<app-tool-bar [isHome]="true" [isCorporative]="isCorporative"></app-tool-bar>

<div class="search-page-container">
  <!-- Hero Header -->
  <div class="search-hero">
    <div class="hero-content">
      <div class="hero-icon">
        <span class="material-icons">search</span>
      </div>
      <h1 class="hero-title">Busca de Documentos</h1>
      <p class="hero-subtitle">Encontre documentos de forma rápida e eficiente</p>
    </div>
  </div>

  <!-- Search Form -->
  <div class="search-content">
    <div class="search-container">
      <div class="search-card">
        <form [formGroup]="searchForm" (ngSubmit)="search()">
          <!-- Quick Search Bar -->
          <div class="quick-search">
            <div class="search-input-group">
              <span class="material-icons search-icon">search</span>
              <input
                type="text"
                class="search-input"
                formControlName="searchText"
                placeholder="Buscar por protocolo, descrição, autor...">
              <button type="submit" class="search-btn" [disabled]="isLoading">
                <span class="material-icons" *ngIf="!isLoading">arrow_forward</span>
                <span class="spinner-border spinner-border-sm" *ngIf="isLoading"></span>
              </button>
            </div>
          </div>

          <!-- Search Scopes -->
          <div class="search-scopes">
            <div class="scope-label">
              <span class="material-icons">filter_list</span>
              Pesquisar em:
            </div>
            <div class="scope-chips">
              <label *ngFor="let scope of searchScopes" class="scope-chip">
                <input type="checkbox" [value]="scope.value" formControlName="searchScopes">
                <span class="chip-content">
                  <span class="material-icons">{{ getIconForScope(scope.value) }}</span>
                  {{ scope.label }}
                </span>
              </label>
            </div>
          </div>

          <!-- Advanced Filters (Collapsible) -->
          <div class="advanced-section">
            <button type="button" class="advanced-toggle" (click)="toggleAdvancedFilters()">
              <span class="material-icons">{{ showAdvancedFilters ? 'expand_less' : 'expand_more' }}</span>
              Filtros Avançados
              <span class="toggle-hint">{{ showAdvancedFilters ? 'Ocultar' : 'Mostrar' }}</span>
            </button>

            <div class="advanced-filters" *ngIf="showAdvancedFilters">
              <div class="filter-grid">
                <div class="filter-item">
                  <label class="filter-label">
                    <span class="material-icons">business</span>
                    Órgão Gerador
                  </label>
                  <select class="filter-select" formControlName="orgaoGerador">
                    <option value="">Todos</option>
                    <!-- Opções dinâmicas viriam do backend -->
                  </select>
                </div>

                <div class="filter-item">
                  <label class="filter-label">
                    <span class="material-icons">domain</span>
                    Unidade Gerada
                  </label>
                  <select class="filter-select" formControlName="unidadeGerada">
                    <option value="">Todas</option>
                    <!-- Opções dinâmicas viriam do backend -->
                  </select>
                </div>

                <div class="filter-item">
                  <label class="filter-label">
                    <span class="material-icons">label</span>
                    Assunto
                  </label>
                  <input type="text" class="filter-input" formControlName="assunto" placeholder="Digite o assunto">
                </div>

                <div class="filter-item">
                  <label class="filter-label">
                    <span class="material-icons">description</span>
                    Tipo de Documento
                  </label>
                  <input type="text" class="filter-input" formControlName="tipoDocumento" placeholder="Digite o tipo">
                </div>

                <div class="filter-item">
                  <label class="filter-label">
                    <span class="material-icons">person</span>
                    Usuário Gerador
                  </label>
                  <input type="text" class="filter-input" formControlName="usuarioGerador" placeholder="Nome do usuário">
                </div>

                <div class="filter-item">
                  <label class="filter-label">
                    <span class="material-icons">event</span>
                    Período Inicial
                  </label>
                  <input type="date" class="filter-input" formControlName="periodoInicial">
                </div>

                <div class="filter-item">
                  <label class="filter-label">
                    <span class="material-icons">event</span>
                    Período Final
                  </label>
                  <input type="date" class="filter-input" formControlName="periodoFinal">
                </div>
              </div>

              <div class="filter-options">
                <label class="option-chip">
                  <input type="checkbox" formControlName="interessado">
                  <span class="chip-content">
                    <span class="material-icons">person_outline</span>
                    Interessado
                  </span>
                </label>
                <label class="option-chip">
                  <input type="checkbox" formControlName="remetente">
                  <span class="chip-content">
                    <span class="material-icons">send</span>
                    Remetente
                  </span>
                </label>
                <label class="option-chip">
                  <input type="checkbox" formControlName="destinatario">
                  <span class="chip-content">
                    <span class="material-icons">inbox</span>
                    Destinatário
                  </span>
                </label>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions">
            <button type="button" class="btn-clear" (click)="clearSearch()" [disabled]="isLoading">
              <span class="material-icons">clear_all</span>
              Limpar Filtros
            </button>
            <button type="submit" class="btn-search" [disabled]="isLoading">
              <span class="material-icons" *ngIf="!isLoading">search</span>
              <span class="spinner-border spinner-border-sm" *ngIf="isLoading"></span>
              {{ isLoading ? 'Pesquisando...' : 'Buscar Documentos' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Results Section -->
    <div class="results-container" *ngIf="documentResults.length > 0">
      <div class="results-header">
        <div class="results-title">
          <span class="material-icons">folder_open</span>
          <h2>Resultados da Busca</h2>
        </div>
        <div class="results-count">
          {{ documentResults.length }} documento{{ documentResults.length !== 1 ? 's' : '' }} encontrado{{ documentResults.length !== 1 ? 's' : '' }}
        </div>
      </div>

      <div class="results-grid">
        <div *ngFor="let doc of documentResults" class="document-card" (click)="viewDocumentDetails(doc)">
          <div class="doc-card-header">
            <div class="doc-icon">
              <span class="material-icons">description</span>
            </div>
            <div class="doc-protocol">
              {{ doc.processIdentifier || doc.generatedProtocol }}
            </div>
          </div>

          <div class="doc-card-body">
            <h3 class="doc-title">{{ doc.subject || doc.observations || 'Sem descrição' }}</h3>

            <div class="doc-meta">
              <div class="meta-item">
                <span class="material-icons">person</span>
                <span>{{ doc.author || 'Não informado' }}</span>
              </div>
              <div class="meta-item">
                <span class="material-icons">event</span>
                <span>{{ doc.documentDate | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>
          </div>

          <div class="doc-card-footer">
            <button class="btn-view">
              <span class="material-icons">visibility</span>
              Ver Detalhes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && documentResults.length === 0 && searchForm.get('searchText')?.value">
      <div class="empty-icon">
        <span class="material-icons">search_off</span>
      </div>
      <h3>Nenhum documento encontrado</h3>
      <p>Tente ajustar os filtros ou usar outros termos de busca</p>
    </div>
  </div>
</div>