<!-- dashboard.component.html -->
<app-tool-bar [title]="viewController.title" [isProfessional]="isProfessional" [isCorporative]="isCorporative">
</app-tool-bar>

<div class="container-fluid main page-content">
  <div class="row main-content">
    <!-- Formulário de Pesquisa à Esquerda -->
    <div class="col-md-4 search-column">
      <div class="card form-card">
        <div class="card-body form-body">
          <form>
            <!-- Filtros Básicos -->
            <div class="form-section-expanded">
              <h6 class="section-title">Filtros Básicos</h6>

              <div class="mb-3">
                <label for="textoPesquisa" class="form-label-expanded">Texto para Pesquisa:</label>
                <input type="text" class="form-control form-control-expanded" id="textoPesquisa"
                  [(ngModel)]="searchFilters.textoPesquisa" name="textoPesquisa" (ngModelChange)="validateSearch()"
                  placeholder="Digite qualquer texto...">
              </div>

              <div class="mb-3">
                <label for="numeroDocumento" class="form-label-expanded">Número:</label>
                <input type="text" class="form-control form-control-expanded" id="numeroDocumento"
                  [(ngModel)]="searchFilters.numeroDocumento" name="numeroDocumento" (ngModelChange)="validateSearch()"
                  placeholder="Ex: 001/2024">
              </div>

              <div class="mb-3">
                <label for="assunto" class="form-label-expanded">Assunto:</label>
                <input type="text" class="form-control form-control-expanded" id="assunto"
                  [(ngModel)]="searchFilters.assunto" name="assunto" (ngModelChange)="validateSearch()"
                  placeholder="Assunto do documento">
              </div>
            </div>

            <!-- Filtros Específicos -->
            <div class="form-section-expanded">
              <h6 class="section-title">Filtros Específicos</h6>

              <div class="mb-3">
                <label for="orgaoGerador" class="form-label-expanded">Órgão Gerador:</label>
                <select class="form-control form-control-expanded" id="orgaoGerador"
                  [(ngModel)]="searchFilters.orgaoGerador" name="orgaoGerador" (ngModelChange)="validateSearch()">
                  <option value="">Selecione...</option>
                  <option value="crea-ba">CREA-BA</option>
                  <option value="emater">EMATER</option>
                  <option value="incra">INCRA</option>
                  <option value="ibama">IBAMA</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="tipoDocumento" class="form-label-expanded">Tipo:</label>
                <select class="form-control form-control-expanded" id="tipoDocumento"
                  [(ngModel)]="searchFilters.tipoDocumento" name="tipoDocumento">
                  <option value="">Todos os tipos</option>
                  <option value="oficio">Ofício</option>
                  <option value="memorando">Memorando</option>
                  <option value="relatorio">Relatório</option>
                  <option value="parecer">Parecer Técnico</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="autor" class="form-label-expanded">Autor:</label>
                <input type="text" class="form-control form-control-expanded" id="autor"
                  [(ngModel)]="searchFilters.autor" name="autor" placeholder="Nome do autor">
              </div>
            </div>

            <!-- Opções de Busca -->
            <div class="form-section-expanded">
              <h6 class="section-title">Opções de Busca</h6>

              <div class="mb-3">
                <label class="form-label-expanded">Pesquisar em:</label>
                <div class="form-check-container-expanded">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="documentos" id="documentos"
                      [(ngModel)]="searchFilters.searchType" name="searchType">
                    <label class="form-check-label" for="documentos">Documentos</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="processos" id="processos"
                      [(ngModel)]="searchFilters.searchType" name="searchType">
                    <label class="form-check-label" for="processos">Processos</label>
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label-expanded">Incluir:</label>
                <div class="form-check-container-expanded">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="gerados" [(ngModel)]="searchFilters.gerados"
                      name="gerados">
                    <label class="form-check-label" for="gerados">Gerados</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="externos" [(ngModel)]="searchFilters.externos"
                      name="externos">
                    <label class="form-check-label" for="externos">Externos</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Botões -->
            <div class="form-actions-expanded">
              <button type="button" class="btn btn-secondary" (click)="clearFilters()">
                Limpar
              </button>
              <button type="button" class="btn btn-primary" (click)="searchDocuments()"
                [disabled]="uiControllers.isLoading">
                <span *ngIf="uiControllers.isLoading" class="spinner-border spinner-border-sm me-2"></span>
                Pesquisar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Lista de Documentos à Direita -->
    <div class="col-md-8 results-column">
      <div class="card form-card">
        <div class="card-body form-body">
          <div class="form-section-expanded">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="section-title mb-0">Documentos Encontrados</h6>
              <span class="badge-iris">{{managerAttributes.documentCount}} resultados</span>
            </div>

            <div *ngIf="messages.errorMessage" class="alert alert-danger message-sm">
              <div [innerHTML]="messages.errorMessage"></div>
            </div>
            <div *ngIf="messages.alertMessage" class="alert alert-warning message-sm">
              <div [innerHTML]="messages.alertMessage"></div>
            </div>

            <!-- Lista de documentos com overflow -->
            <div class="document-list-scroll">

              <div class="text-muted text-center py-4" *ngIf="managerAttributes.documentCount === 0">
                <span class="material-icons" style="font-size: 32px;">search</span>
                <p class="mt-2 small">Use os filtros para buscar documentos</p>
              </div>

              <!-- Resultados reais da pesquisa -->
              <div *ngIf="managerAttributes.documentCount > 0">
                <div class="document-item" *ngFor="let document of managerAttributes.searchResults">
                  <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
                    <div>
                      <strong>{{document.name}}</strong><br>
                      <small class="text-muted">
                        <strong>Tipo:</strong> {{document.documentType}} |
                        Autor: {{document.author || 'N/A'}} |
                        Data: {{document.documentDate | date:'dd/MM/yyyy'}}
                      </small>
                      <div *ngIf="document.subject" class="text-muted small mt-1">
                        <strong>Assunto:</strong> {{document.subject}}
                      </div>
                      <div class="text-muted small">
                        <strong>N° Documento:</strong> {{document.uniqueIdentifier}}
                        <strong>Processo:</strong> {{document.processIdentifier}}
                      </div>
   
                    </div>
                    <button type="button" class="btn btn-primary btn-sm" (click)="viewDocument(document)">Ver</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" *ngIf="uiControllers.isLoading">
  <div class="progress-bar-loading">
    <div class="progress-bar-loading-value"></div>
  </div>
</div>