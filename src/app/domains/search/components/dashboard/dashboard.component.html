<!-- dashboard.component.html -->
<app-tool-bar [title]="viewController.title" [isProfessional]="isProfessional" [isCorporative]="isCorporative">
</app-tool-bar>

<div class="container-fluid main page-content">
  <div class="row main-content">
    <!-- Formulário de Pesquisa à Esquerda -->
    <div class="col-md-4 search-column">
      <div class="card form-card">
        <div class="card-body form-body">
          <form>
            <!-- Filtros Básicos -->
            <div class="form-section-expanded">
              <h6 class="section-title">Busca Rápida</h6>

              <div class="mb-3">
                <label for="searchText" class="form-label-expanded">Busca Global:</label>
                <input type="text" class="form-control form-control-expanded" id="searchText"
                  [(ngModel)]="searchFilters.searchText" name="searchText" (ngModelChange)="validateSearch()"
                  placeholder="Nome, assunto, palavras-chave...">
              </div>

              <div class="mb-3">
                <label for="documentNumber" class="form-label-expanded">Número do Documento:</label>
                <input type="text" class="form-control form-control-expanded" id="documentNumber"
                  [(ngModel)]="searchFilters.documentNumber" name="documentNumber" (ngModelChange)="validateSearch()"
                  placeholder="Processo ou ID único">
              </div>

              <div class="mb-3">
                <label for="subject" class="form-label-expanded">Assunto:</label>
                <input type="text" class="form-control form-control-expanded" id="subject"
                  [(ngModel)]="searchFilters.subject" name="subject" (ngModelChange)="validateSearch()"
                  placeholder="Assunto do documento">
              </div>
            </div>

            <!-- Botão para expandir filtros avançados -->
            <button type="button" class="btn-expand-filters" (click)="toggleAdvancedFilters()">
              <mat-icon>{{ showAdvancedFilters ? 'expand_less' : 'expand_more' }}</mat-icon>
              {{ showAdvancedFilters ? 'Ocultar Filtros Avançados' : 'Mostrar Filtros Avançados' }}
            </button>

            <!-- Filtros Específicos -->
            <div class="form-section-expanded" *ngIf="showAdvancedFilters">
              <h6 class="section-title">Filtros Específicos</h6>

              <div class="mb-3">
                <label for="documentTypeId" class="form-label-expanded">Tipo de Documento:</label>
                <select class="form-control form-control-expanded" id="documentTypeId"
                  [(ngModel)]="searchFilters.documentTypeId" name="documentTypeId">
                  <option value="">Todos os tipos</option>
                  <option *ngFor="let type of documentType" [value]="type.id">
                    {{ type.name }}
                  </option>
                </select>
              </div>

              <div class="mb-3">
                <label for="producer" class="form-label-expanded">Produtor:</label>
                <input type="text" class="form-control form-control-expanded" id="producer"
                  [(ngModel)]="searchFilters.producer" name="producer" placeholder="Nome do produtor">
              </div>

              <div class="mb-3">
                <label for="recipient" class="form-label-expanded">Destinatário:</label>
                <input type="text" class="form-control form-control-expanded" id="recipient"
                  [(ngModel)]="searchFilters.recipient" name="recipient" placeholder="Nome do destinatário">
              </div>

              <div class="mb-3">
                <label for="currentDepartment" class="form-label-expanded">Setor Atual:</label>
                <input type="text" class="form-control form-control-expanded" id="currentDepartment"
                  [(ngModel)]="searchFilters.currentDepartment" name="currentDepartment"
                  placeholder="Nome do setor">
              </div>

              <div class="mb-3">
                <label for="startDate" class="form-label-expanded">Data Início:</label>
                <input type="date" class="form-control form-control-expanded" id="startDate"
                  [(ngModel)]="searchFilters.startDate" name="startDate">
              </div>

              <div class="mb-3">
                <label for="endDate" class="form-label-expanded">Data Fim:</label>
                <input type="date" class="form-control form-control-expanded" id="endDate"
                  [(ngModel)]="searchFilters.endDate" name="endDate">
              </div>

              <div class="mb-3">
                <label for="keywords" class="form-label-expanded">Palavras-chave:</label>
                <input type="text" class="form-control form-control-expanded" id="keywords"
                  [(ngModel)]="searchFilters.keywords" name="keywords" placeholder="Palavras-chave">
              </div>
            </div>

            <!-- Filtros de Status -->
            <div class="form-section-expanded" *ngIf="showAdvancedFilters">
              <h6 class="section-title">Filtros de Status</h6>

              <div class="mb-3">
                <label for="status" class="form-label-expanded">Situação:</label>
                <select class="form-control form-control-expanded" id="status" [(ngModel)]="searchFilters.status"
                  name="status">
                  <option value="">Todas</option>
                  <option value="ativo">Ativo</option>
                  <option value="arquivado">Arquivado</option>
                  <option value="tramitando">Tramitando</option>
                </select>
              </div>

              <div class="mb-3">
                <div class="form-check-container-expanded">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="onlyPublic"
                      [(ngModel)]="searchFilters.onlyPublic" name="onlyPublic">
                    <label class="form-check-label" for="onlyPublic">Apenas Públicos</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="onlyConfidential"
                      [(ngModel)]="searchFilters.onlyConfidential" name="onlyConfidential">
                    <label class="form-check-label" for="onlyConfidential">Apenas Confidenciais</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Botões -->
            <div class="form-actions-expanded">
              <button type="button" class="btn btn-secondary" (click)="clearFilters()">
                Limpar
              </button>
              <button type="button" class="btn btn-primary" (click)="searchDocuments()"
                [disabled]="uiControllers.isLoading">
                <span *ngIf="uiControllers.isLoading" class="spinner-border spinner-border-sm me-2"></span>
                Pesquisar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Lista de Documentos à Direita -->
    <div class="col-md-8 results-column">
      <div class="card form-card">
        <div class="card-body form-body">
          <div class="form-section-expanded">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="section-title mb-0">Documentos Encontrados</h6>
              <span class="badge-iris">{{managerAttributes.documentCount}} resultados</span>
            </div>

            <div *ngIf="messages.errorMessage" class="alert alert-danger message-sm">
              <div [innerHTML]="messages.errorMessage"></div>
            </div>
            <div *ngIf="messages.alertMessage" class="alert alert-warning message-sm">
              <div [innerHTML]="messages.alertMessage"></div>
            </div>

            <!-- Lista de documentos com overflow -->
            <div class="document-list-scroll">

              <div class="text-muted text-center py-4" *ngIf="managerAttributes.documentCount === 0">
                <span class="material-icons" style="font-size: 32px;">search</span>
                <p class="mt-2 small">Use os filtros para buscar documentos</p>
              </div>

              <!-- Resultados reais da pesquisa -->
              <div *ngIf="managerAttributes.documentCount > 0">
                <div class="document-item" *ngFor="let document of managerAttributes.searchResults">
                  <div class="doc-card">
                    <div class="doc-header-row">
                      <div class="doc-title-section">
                        <h6 class="doc-title">{{document.name || 'Sem título'}}</h6>
                        <span class="doc-id-badge">{{document.uniqueIdentifier || document.processIdentifier}}</span>
                      </div>
                      <button type="button" class="btn btn-primary btn-sm" (click)="viewDocument(document)">Ver</button>
                    </div>

                    <div class="doc-meta-row" *ngIf="document.documentType || document.author || document.documentDate">
                      <span class="doc-meta-item" *ngIf="document.documentType">
                        <span class="material-icons-small">description</span>{{document.documentType}}
                      </span>
                      <span class="doc-meta-item" *ngIf="document.author">
                        <span class="material-icons-small">person</span>{{document.author}}
                      </span>
                      <span class="doc-meta-item" *ngIf="document.documentDate">
                        <span class="material-icons-small">event</span>{{document.documentDate | date:'dd/MM/yyyy'}}
                      </span>
                    </div>

                    <div class="doc-subject" *ngIf="document.subject">
                      {{document.subject}}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Controles de Paginação -->
            <div class="pagination-controls" *ngIf="pagination.totalPages > 1">
              <div class="pagination-info">
                Página {{pagination.currentPage + 1}} de {{pagination.totalPages}}
                ({{managerAttributes.documentCount}} documentos)
              </div>

              <div class="pagination-buttons">
                <!-- Primeira página -->
                <button type="button" class="btn btn-pagination" (click)="firstPage()"
                  [disabled]="pagination.currentPage === 0 || uiControllers.isLoading" title="Primeira página">
                  <mat-icon>first_page</mat-icon>
                </button>

                <!-- Página anterior -->
                <button type="button" class="btn btn-pagination" (click)="previousPage()"
                  [disabled]="pagination.currentPage === 0 || uiControllers.isLoading" title="Página anterior">
                  <mat-icon>chevron_left</mat-icon>
                </button>

                <!-- Páginas numeradas -->
                <button type="button" *ngFor="let page of pagination.displayPages"
                  class="btn btn-pagination btn-page-number" [class.active]="page === pagination.currentPage"
                  (click)="goToPage(page)" [disabled]="uiControllers.isLoading">
                  {{page + 1}}
                </button>

                <!-- Próxima página -->
                <button type="button" class="btn btn-pagination" (click)="nextPage()"
                  [disabled]="pagination.currentPage >= pagination.totalPages - 1 || uiControllers.isLoading"
                  title="Próxima página">
                  <mat-icon>chevron_right</mat-icon>
                </button>

                <!-- Última página -->
                <button type="button" class="btn btn-pagination" (click)="lastPage()"
                  [disabled]="pagination.currentPage >= pagination.totalPages - 1 || uiControllers.isLoading"
                  title="Última página">
                  <mat-icon>last_page</mat-icon>
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" *ngIf="uiControllers.isLoading">
  <div class="progress-bar-loading">
    <div class="progress-bar-loading-value"></div>
  </div>
</div>