<app-tool-bar [title]="'Gerenciamento de Usuários'" [isProfessional]="false" [isCorporative]="true">
</app-tool-bar>

<div class="user-management-container">
  <!-- Header com título e ação principal -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <span class="material-icons">people</span>
          Gerenciamento de Usuários
        </h1>
        <p class="page-subtitle">Gerencie usuários, roles e permissões do sistema</p>
      </div>
      <div class="actions-section">
        <button type="button" class="btn btn-primary btn-create" (click)="createUser()" [disabled]="isLoading">
          <span class="material-icons">person_add</span>
          Criar Usuário
        </button>
      </div>
    </div>
  </div>

  <!-- Mensagens -->
  <div *ngIf="messages.errorMessage" class="alert alert-danger" style="margin-bottom: 15px;">
    {{ messages.errorMessage }}
  </div>
  <div *ngIf="messages.alertMessage" class="alert alert-warning" style="margin-bottom: 15px;">
    {{ messages.alertMessage }}
  </div>
  <div *ngIf="messages.successMessage" class="alert alert-success" style="margin-bottom: 15px;">
    {{ messages.successMessage }}
  </div>

  <!-- Estatísticas rápidas -->
  <div class="stats-section" *ngIf="!isLoading && totalUsers > 0">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <span class="material-icons">people</span>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ totalUsers }}</div>
          <div class="stat-label">Total de Usuários</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon active">
          <span class="material-icons">check_circle</span>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ getActiveUsersCount() }}</div>
          <div class="stat-label">Usuários Ativos</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon inactive">
          <span class="material-icons">block</span>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ getInactiveUsersCount() }}</div>
          <div class="stat-label">Usuários Inativos</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon admin">
          <span class="material-icons">admin_panel_settings</span>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ getAdminUsersCount() }}</div>
          <div class="stat-label">Administradores</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros e Busca -->
  <div class="filters-section">
    <div class="filters-container">
      <div class="search-box">
        <div class="search-input-group">
          <span class="material-icons search-icon">search</span>
          <input
            type="text"
            class="search-input"
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
            placeholder="Buscar por nome ou email..."
            [disabled]="isLoading">
          <button
            *ngIf="searchTerm"
            class="clear-search-btn"
            (click)="searchTerm = ''; onSearchChange()"
            type="button">
            <span class="material-icons">close</span>
          </button>
        </div>
      </div>
      <div class="filter-controls">
        <div class="page-size-selector">
          <label>Itens por página:</label>
          <select class="form-control" [(ngModel)]="pageSize" (change)="onPageSizeChange()">
            <option value="6">6</option>
            <option value="12">12</option>
            <option value="24">24</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center" style="padding: 40px;">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p>Carregando usuários...</p>
  </div>

  <!-- Lista vazia -->
  <div *ngIf="!isLoading && totalUsers === 0" class="text-center" style="padding: 40px;">
    <span class="material-icons" style="font-size: 48px; color: #ccc;">people_outline</span>
    <h6>Nenhum usuário encontrado</h6>
    <p class="text-muted">
      {{ searchTerm ? 'Tente ajustar os filtros de busca ou criar um novo usuário.' : 'Comece criando o primeiro usuário do sistema.' }}
    </p>
    <button type="button" class="btn btn-outline-primary" (click)="createUser()">
      <span class="material-icons">person_add</span>
      Criar Primeiro Usuário
    </button>
  </div>

  <!-- Lista de usuários -->
  <div *ngIf="!isLoading && totalUsers > 0" class="users-grid">
    <div *ngFor="let user of currentData; trackBy: trackByUserId" class="user-card-wrapper">
      <div class="user-card" [class.inactive]="!user.isActive">
        <!-- Status Badge -->
        <div class="status-badge" [class.active]="user.isActive" [class.inactive]="!user.isActive">
          <span class="material-icons">{{ user.isActive ? 'check_circle' : 'block' }}</span>
          {{ getStatusText(user.isActive) }}
        </div>

        <!-- Avatar e informações principais -->
        <div class="user-header">
          <div class="user-avatar">
            <span class="material-icons">person</span>
          </div>
          <div class="user-info">
            <h3 class="user-name">{{ user.name }}</h3>
            <p class="user-email">{{ user.email }}</p>
          </div>
        </div>

        <!-- Role e permissões -->
        <div class="user-details">
          <div class="role-info" *ngIf="user.role">
            <span class="material-icons">admin_panel_settings</span>
            <div class="role-content">
              <div class="role-name">{{ user.role.name }}</div>
              <div class="role-description">{{ user.role.description }}</div>
            </div>
          </div>

          <div class="permissions-info">
            <span class="material-icons">security</span>
            <div class="permissions-text">
              {{ getUserPermissionsText(user) }}
            </div>
          </div>

          <div class="user-meta">
            <div class="meta-item" *ngIf="user.createdAt">
              <span class="material-icons">schedule</span>
              <span>Criado em {{ formatDate(user.createdAt) }}</span>
            </div>
            <div class="meta-item" *ngIf="user.lastLogin">
              <span class="material-icons">login</span>
              <span>Último acesso: {{ formatDate(user.lastLogin) }}</span>
            </div>
          </div>
        </div>

        <!-- Ações -->
        <div class="user-actions">
          <button
            type="button"
            class="action-btn primary"
            (click)="editUser(user)"
            [disabled]="isLoading"
            title="Editar usuário">
            <span class="material-icons">edit</span>
            Editar
          </button>

          <button
            type="button"
            class="action-btn"
            [class.warning]="user.isActive"
            [class.success]="!user.isActive"
            (click)="toggleUserStatus(user)"
            [disabled]="isLoading"
            [title]="user.isActive ? 'Desativar usuário' : 'Ativar usuário'">
            <span class="material-icons">{{ user.isActive ? 'block' : 'check_circle' }}</span>
            {{ user.isActive ? 'Desativar' : 'Ativar' }}
          </button>

          <button
            type="button"
            class="action-btn danger"
            (click)="deleteUser(user)"
            [disabled]="isLoading"
            title="Excluir usuário">
            <span class="material-icons">delete</span>
            Excluir
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Paginação -->
  <div *ngIf="!isLoading && totalUsers > 0 && totalPages > 1" class="pagination-section">
    <div class="pagination-info">
      <span>Mostrando {{ (currentPage - 1) * pageSize + 1 }} a {{ Math.min(currentPage * pageSize, totalUsers) }} de {{ totalUsers }} usuários</span>
    </div>
    <nav class="pagination-nav">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="!hasPreviousPage">
          <button class="page-link" (click)="previousPage()" [disabled]="!hasPreviousPage">
            <span class="material-icons">chevron_left</span>
            Anterior
          </button>
        </li>

        <li *ngFor="let page of getPageNumbers()"
            class="page-item"
            [class.active]="page === currentPage">
          <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
        </li>

        <li class="page-item" [class.disabled]="!hasNextPage">
          <button class="page-link" (click)="nextPage()" [disabled]="!hasNextPage">
            Próxima
            <span class="material-icons">chevron_right</span>
          </button>
        </li>
      </ul>
    </nav>
  </div>

</div>